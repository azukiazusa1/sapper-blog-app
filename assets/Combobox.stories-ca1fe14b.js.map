{"version":3,"file":"Combobox.stories-ca1fe14b.js","sources":["../../src/components/Combobox/DropDownItem.svelte","../../src/components/Icons/Loading.svelte","../../src/components/Combobox/DropDownMenu.svelte","../../src/components/Combobox/Input.svelte","../../src/components/Combobox/Combobox.svelte","../../src/components/Combobox/Combobox.stories.ts"],"sourcesContent":["<script lang=\"ts\">\n  export let imageUrl: string;\n  export let text: string;\n  export let selected: boolean;\n  export let id: string;\n</script>\n\n<li\n  role=\"option\"\n  aria-selected={selected}\n  {id}\n  class={`-mx-2 flex transform cursor-pointer items-center border-b px-4 py-3 transition-colors duration-200 last:border-0 hover:bg-gray-100 dark:border-zinc-700 dark:hover:bg-zinc-500 ${\n    selected ? \"bg-gray-100 dark:bg-zinc-500\" : \"\"\n  }`}\n  on:mousedown\n>\n  <img class=\"mx-1 h-8 w-8 rounded-full object-cover\" src={imageUrl} alt=\"\" />\n  <p class=\"mx-2 text-sm text-gray-600 dark:text-gray-50\">\n    {text}\n  </p>\n</li>\n","<svg\n  class=\"inline\"\n  version=\"1.1\"\n  id=\"loader-1\"\n  xmlns=\"http://www.w3.org/2000/svg\"\n  xmlns:xlink=\"http://www.w3.org/1999/xlink\"\n  x=\"0px\"\n  y=\"0px\"\n  width=\"40px\"\n  height=\"40px\"\n  viewBox=\"0 0 50 50\"\n  style=\"enable-background:new 0 0 50 50;\"\n  xml:space=\"preserve\"\n>\n  <path\n    fill=\"currentColor\"\n    d=\"M25.251,6.461c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615V6.461z\"\n  >\n    <animateTransform\n      attributeType=\"xml\"\n      attributeName=\"transform\"\n      type=\"rotate\"\n      from=\"0 25 25\"\n      to=\"360 25 25\"\n      dur=\"0.6s\"\n      repeatCount=\"indefinite\"\n    />\n  </path>\n</svg>\n","<script lang=\"ts\">\n  import DropDownItem from \"./DropDownItem.svelte\";\n  import Loading from \"../Icons/Loading.svelte\";\n  import type { Item } from \"./types\";\n  import { createEventDispatcher } from \"svelte\";\n  const dispatch = createEventDispatcher<{\n    select: Item;\n  }>();\n\n  export let items: Item[];\n  export let loading = false;\n  export let listboxId: string;\n  export let optionId: string;\n  export let activeIndex: number | null = null;\n</script>\n\n<div\n  on:keydown\n  class=\"overflow-hiddenrounded-br-md absolute z-20 max-h-96 w-72 overflow-y-scroll rounded-bl-md border-2 border-t-0 border-gray-200 bg-white shadow-lg dark:border-zinc-700 dark:bg-zinc-700\"\n>\n  {#if loading}\n    <div class=\"py-2 text-center\" aria-live=\"polite\" aria-atomic=\"true\">\n      <div class=\"sr-only\">検索中</div>\n      <Loading />\n    </div>\n  {:else if items.length === 0}\n    <div class=\"py-2 text-center\" aria-live=\"polite\" aria-atomic=\"true\">\n      <p class=\"text-gray-500 dark:text-gray-300\">検索結果がありません</p>\n    </div>\n  {:else}\n    <ul class=\"py-2\" role=\"listbox\" aria-label=\"検索結果\" id={listboxId}>\n      {#each items as item, index (item.key)}\n        <DropDownItem\n          imageUrl={item.imageUrl}\n          text={item.text}\n          selected={index === activeIndex}\n          id={`${optionId}-${index}`}\n          on:mousedown={() => {\n            dispatch(\"select\", item);\n          }}\n        />\n      {/each}\n    </ul>\n  {/if}\n</div>\n","<script lang=\"ts\">\n  import SearchIcon from \"../Icons/Search.svelte\";\n  export let value = \"\";\n  export let placeholder = \"\";\n  export let name = \"\";\n  export let isOpen = false;\n  export let inputId = \"\";\n  export let listboxId = \"\";\n  export let optionId = \"\";\n  export let activeIndex: number | null;\n\n  export const focus = () => {\n    input.focus();\n  };\n\n  let input: HTMLInputElement;\n</script>\n\n<div\n  class=\"flex w-full rounded-lg border-2 border-gray-300 dark:border-zinc-700\"\n>\n  <input\n    bind:value\n    bind:this={input}\n    on:focus\n    on:blur\n    on:keydown\n    on:input\n    class=\"h-10 w-60 rounded-l-lg px-5 focus:outline-none dark:bg-zinc-900\"\n    type=\"text\"\n    id={inputId}\n    {name}\n    {placeholder}\n    role=\"combobox\"\n    aria-autocomplete=\"both\"\n    aria-expanded={isOpen}\n    aria-controls={listboxId}\n    aria-activedescendant={activeIndex !== null\n      ? `${optionId}-${activeIndex}`\n      : undefined}\n  />\n  <button class=\"flex justify-end rounded-r-lg p-2\" aria-label=\"検索\">\n    <SearchIcon className=\"text-gray-600 dark:text-gray-50 h-6 w-6\" />\n  </button>\n</div>\n","<script lang=\"ts\">\n  import DropDownMenu from \"./DropDownMenu.svelte\";\n  import Input from \"./Input.svelte\";\n  import type { Item } from \"./types\";\n  import { createEventDispatcher } from \"svelte\";\n  const dispatch = createEventDispatcher<{\n    select: Item;\n  }>();\n\n  export let value = \"\";\n  export let loading = false;\n  export let items: Item[] = [];\n\n  let inputElement: { focus: () => void };\n  let activeIndex: number | null = null;\n  let isOpen = false;\n\n  const inputId = \"combobox\";\n  const listboxId = \"listbox\";\n  const optionId = \"option\";\n\n  $: itemCount = items.length;\n  $: {\n    if (!isOpen) {\n      activeIndex = null;\n    }\n  }\n\n  const handleInput = () => {\n    if (!value.trim()) {\n      isOpen = false;\n    } else {\n      isOpen = true;\n    }\n  };\n\n  const handleFocus = () => {\n    if (value.trim()) {\n      isOpen = true;\n    }\n  };\n\n  const handleBlur = () => {\n    isOpen = false;\n  };\n\n  const handleSelect = (e: CustomEvent<Item>) => {\n    value = e.detail.text;\n    dispatch(\"select\", e.detail);\n  };\n  /**\n   * 選択された要素が見えるようにスクロール\n   */\n  const scrollToOption = (index: number) => {\n    const listboxNode = document.getElementById(listboxId);\n    const opt = document.getElementById(`${optionId}-${index}`);\n    if (!listboxNode || !opt) return;\n\n    opt.scrollIntoView({ behavior: \"smooth\", block: \"nearest\" });\n  };\n\n  const navigateList = (e: KeyboardEvent) => {\n    if (e.key === \"ArrowDown\") {\n      e.preventDefault();\n      if (activeIndex === null) {\n        isOpen = true;\n        activeIndex = 0;\n      } else if (activeIndex < itemCount - 1) {\n        activeIndex++;\n      } else {\n        activeIndex = 0;\n      }\n      scrollToOption(activeIndex);\n    } else if (e.key === \"ArrowUp\") {\n      e.preventDefault();\n      if (activeIndex === null) {\n        isOpen = true;\n        activeIndex = 0;\n      } else if (activeIndex > 0) {\n        activeIndex--;\n      } else {\n        activeIndex = itemCount - 1;\n      }\n      scrollToOption(activeIndex);\n    } else if (e.key === \"Enter\") {\n      isOpen = false;\n      if (activeIndex !== null) {\n        e.preventDefault();\n        handleSelect({ detail: items[activeIndex] } as CustomEvent<Item>);\n        activeIndex = null;\n      }\n    } else if (e.key === \"Escape\") {\n      e.preventDefault();\n      inputElement.focus();\n\n      if (isOpen) {\n        isOpen = false;\n        activeIndex = null;\n      } else {\n        value = \"\";\n      }\n    }\n  };\n</script>\n\n<Input\n  bind:this={inputElement}\n  bind:value\n  on:focus={handleFocus}\n  on:blur={handleBlur}\n  on:keydown={navigateList}\n  on:input={handleInput}\n  {inputId}\n  {listboxId}\n  {optionId}\n  {activeIndex}\n  placeholder=\"Search\"\n/>\n{#if isOpen}\n  <DropDownMenu\n    {items}\n    {loading}\n    {listboxId}\n    {optionId}\n    {activeIndex}\n    on:select={handleSelect}\n  />\n{/if}\n","import type { Meta, StoryObj } from \"@storybook/svelte\";\nimport Combobox from \"./Combobox.svelte\";\nimport type { Item } from \"./types\";\nconst meta = ({\n  title: \"Combobox\",\n  component: Combobox,\n  tags: [\"autodocs\"],\n  argTypes: {\n    items: {\n      control: {\n        type: \"object\"\n      },\n      describe: \"選択肢の配列。各要素は { imageUrl: string, text: string, key: string } の形式である必要がある。\"\n    },\n    loading: {\n      control: {\n        type: \"boolean\"\n      },\n      describe: \"ローディング中かどうか\"\n    },\n    value: {\n      control: {\n        type: \"text\"\n      },\n      describe: \"入力されている値\"\n    }\n  }\n} satisfies Meta<Combobox>);\nexport default meta;\ntype Story = StoryObj<Combobox>;\nconst items: Item[] = [{\n  imageUrl: \"https://placehold.jp/24/cccccc/ffffff/150x150.png?text=1\",\n  text: \"Item 1\",\n  key: \"1\"\n}, {\n  imageUrl: \"https://placehold.jp/24/cccccc/ffffff/150x150.png?text=2\",\n  text: \"Item 2\",\n  key: \"2\"\n}, {\n  imageUrl: \"https://placehold.jp/24/cccccc/ffffff/150x150.png?text=3\",\n  text: \"Item 3\",\n  key: \"3\"\n}, {\n  imageUrl: \"https://placehold.jp/24/cccccc/ffffff/150x150.png?text=4\",\n  text: \"Item 4\",\n  key: \"4\"\n}, {\n  imageUrl: \"https://placehold.jp/24/cccccc/ffffff/150x150.png?text=5\",\n  text: \"Item 5\",\n  key: \"5\"\n}];\nexport const Default: Story = {\n  args: {\n    items,\n    loading: false,\n    value: \"\"\n  }\n};\nexport const Loading: Story = {\n  args: {\n    items,\n    value: \"hoge\",\n    loading: true\n  }\n};\nexport const noResults: Story = {\n  args: {\n    items: [],\n    loading: false,\n    value: \"hoge\"\n  }\n};\nDefault.parameters = {\n  ...Default.parameters,\n  docs: {\n    ...Default.parameters?.docs,\n    source: {\n      originalSource: \"{\\n  args: {\\n    items,\\n    loading: false,\\n    value: \\\"\\\"\\n  }\\n}\",\n      ...Default.parameters?.docs?.source\n    }\n  }\n};\nLoading.parameters = {\n  ...Loading.parameters,\n  docs: {\n    ...Loading.parameters?.docs,\n    source: {\n      originalSource: \"{\\n  args: {\\n    items,\\n    value: \\\"hoge\\\",\\n    loading: true\\n  }\\n}\",\n      ...Loading.parameters?.docs?.source\n    }\n  }\n};\nnoResults.parameters = {\n  ...noResults.parameters,\n  docs: {\n    ...noResults.parameters?.docs,\n    source: {\n      originalSource: \"{\\n  args: {\\n    items: [],\\n    loading: false,\\n    value: \\\"hoge\\\"\\n  }\\n}\",\n      ...noResults.parameters?.docs?.source\n    }\n  }\n};"],"names":["ctx","attr","img","img_src_value","insert_hydration","target","li","anchor","append_hydration","p","imageUrl","$$props","text","selected","id","svg","path","animateTransform","get_key","i","ul","div","div1","div0","dirty","dropdownitem_changes","dispatch","createEventDispatcher","items","loading","listboxId","optionId","activeIndex","item","input_1","input_1_aria_activedescendant_value","button","current","value","placeholder","name","isOpen","inputId","focus","input","$$value","create_if_block","inputElement","handleInput","$$invalidate","handleFocus","handleBlur","handleSelect","e","scrollToOption","index","listboxNode","opt","navigateList","itemCount","meta","Combobox","Default","Loading","noResults","_a","_c","_b"],"mappings":"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"}